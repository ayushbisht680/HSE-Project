{% load static %}
<!DOCTYPE html>
<html>
   <head>
      <meta charset="utf-8">
      <meta http-equiv="X-UA-Compatible" content="IE=edge">
      <title>Violation Memo Form</title>
      <meta name="description" content="">
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <link rel="stylesheet" href="">
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
   </head>
   <style>
      .mainTable{
      display:flex;
      width:3058px;
      height: 65px;
      border-top: 1px solid black;
      border-bottom: 1px solid black;
      align-items: center;
      }
      .Srno{
      display: flex;
      align-items: center;
      width:127px;
      height: 60px;;
      }
      .commonWidth{
      display: flex;
      align-items: center;
      width:251px;
      height: 60px;;
      }
      .chnWidth{
      display: flex;
      align-items: center;
      width:339px;
      height: 60px;;
      }
      p{
      margin-left: 15px;
      color: gray;
      font-weight: 600;
      margin-bottom: 0px;
      }
      .valueInput{
      height:43px;
      margin-left: 15px;
      background-color: #d5e9f1;;
      border: none;
      outline: none;
      font-size: 15px;
      font-weight: 600;
      }
     
      .CLassdropdown{
         width: 110px;
         height: 28px;
         font-size: 13px;
         padding: 0px;
         margin-left: 15px;
         border: 1.5px solid #2c8ff1 !important;
         color: #2c8ff1 !important;
         border-radius: 6px;
      
      }
      .btn{
         margin-left: 15px;
         font-size: 11px;
         height: 31px;
         width: 87px;
         border: 1.5px solid #2c8ff1 !important;
         color: #2c8ff1 !important;
         font-weight: 500;
      }
      
      .rowTable1{
      display:flex;
      width:3058px;
      height: 65px;
      align-items: center;
      background-color: #d5e9f1;;
      }
      .srWidth{
      width: 70px;
      }
      .heading{
      display:flex;
      align-items: center;
      width:3058px;
      height: 65px;
      }
     
      .extraspace{
      width:339px;
      }

      
      #formContainer > div:nth-child(even) {
         background-color: #d5e9f1;
     }

     #formContainer > div:nth-child(odd) {
         background-color: white;
     }
     #formContainer > div:nth-child(odd) .valueInput {
      background-color: white;
  }
  .submitBUtton{
   background-color:#2c8ff1 !important;
   color:white !important;
   font-size: 12px !important;

  }
   </style>
   <body>
      <div class="heading">
         <h6>Violation Memo Form Details</h6>
      </div>
      <div class='mainTable'>
         <div class='Srno'>
            <p>Sr.No</p>
         </div>
         <div class='commonWidth'>
            <p>Date</p>
         </div>
         <div class='commonWidth'>
            <p>Project Name</p>
         </div>
         <div class='commonWidth'>
            <p>Project Code</p>
         </div>
         <div class='commonWidth'>
            <p>Business Segment</p>
         </div>
         <div class='commonWidth'>
            <p>Memo No.</p>
         </div>
         <div class='commonWidth'>
            <p>Description</p>
         </div>
         <div class='commonWidth'>
            <p>Action Taken</p>
         </div>
         <div class='commonWidth'>
            <p>Issued By</p>
         </div>
         <div class='chnWidth'>
            <p>Issued To (Contrator Name)</p>
         </div>
         <div class='commonWidth'>
            <p>Penalty Imposed</p>
         </div>
         <div class='commonWidth'>
            <p>Amount</p>
         </div>
         <div class='Srno'>
            <p></p>
         </div>
        
      </div>
      
      <form method="POST" action="{% url 'violation_form' %}" enctype="multipart/form-data" id="">
         {% csrf_token %}
         <div class="rowTable1">
            <input type="hidden" name="week_number" id="week_number_Form1" value="">
            <input type="hidden" name="year" id="year_form1" value="">
            <div class="Srno"><input type="text" class="srWidth valueInput" placeholder="Sr.No" name="SrNo" required></div>
            <div class="commonWidth"><input type="date" class="valueInput" placeholder="Date" name="Date" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Project Name" name="ProjectName" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Project Code" name="ProjectCode" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Business Segment" name="BusinessSegment" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Memo No." name="MemoNo" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Description" name="Description" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Action Taken" name="ActionTaken" required></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Issued By" name="IssuedBy" required></div>
            <div class="chnWidth"><input type="text" class=" extraspace valueInput" placeholder="Issued To" name="IssuedTo" required></div>
            <div class="commonWidth">
               <select class="CLassdropdown" name="PenaltyImposed" required>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                  <option value="NA">NA</option>
               </select>
            </div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Amount" name="Amount" required></div>
            <div class="Srno">
               <button type="submit" class="btn submitBUtton" onclick="calculateWeekAndYearForm1();">Submit</button>
            </div>
            
           
         </div>
      </form>
     
      <div id="formContainer"></div>

      <template id="formRowTemplate">
        <div class="rowTable1">
            <input type="hidden" name="week_number" id="week_number_Form1" value="">
            <input type="hidden" name="year" id="year_form1" value="">
            <div class="Srno"><input type="text" class="srWidth valueInput" placeholder="Sr.No" name="SrNo" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Date" name="Date" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Project Name" name="ProjectName" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Project Code" name="ProjectCode" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Business Segment" name="BusinessSegment" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Memo No." name="MemoNo" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Description" name="Description" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Action Taken" name="ActionTaken" disabled></div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Issued By" name="IssuedBy" disabled></div>
            <div class="chnWidth"><input type="text" class=" extraspace valueInput" placeholder="Issued To" name="IssuedTo" disabled></div>
            <div class="commonWidth">
               <select class="CLassdropdown" name="PenaltyImposed" disabled>
                  <option value="Yes">Yes</option>
                  <option value="No">No</option>
                  <option value="NA">NA</option>
               </select>
            </div>
            <div class="commonWidth"><input type="text" class="valueInput" placeholder="Amount" name="Amount" disabled></div>
            <div class="Srno">
            </div>
            
           
         </div>
      </template>      
      
   </body>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
   
   <script>
      populateInputField()


      function populateInputField() {
         const today = new Date();
         const weekNumber = getWeekNumber(today);
         const year = today.getFullYear()         
         
      fetch(`/api/child-models/?week_number=${weekNumber}&year=${year}&plant_code=10000`)
      .then(response => response.json())
      .then(data => {
         console.log(data)
        data=data['Violation Memo From']
        createAndPopulateFormRows(data);
      })
      .catch(error => {
          console.error('Error:', error);
      });
         }

     
     

function createAndPopulateFormRow(dataItem) {
   const template = document.getElementById('formRowTemplate');
   const newRow = document.importNode(template.content, true);
   

   const inputFields = newRow.querySelectorAll('.valueInput');
   for (const field of inputFields) {
       const fieldName = field.getAttribute('name');
       field.value = dataItem[fieldName] || '';
   }

   const formContainer = document.getElementById('formContainer');
   formContainer.appendChild(newRow);
  

 
}

function createAndPopulateFormRows(data) {
   for (const dataItem of data) {      
     createAndPopulateFormRow(dataItem);
   }
}

      function getWeekNumber(date) {
         date = new Date(date);
         date.setHours(0, 0, 0, 0);
         date.setDate(date.getDate() + 4 - (date.getDay() || 7));
         var yearStart = new Date(date.getFullYear(), 0, 1);
         var weekNumber = Math.ceil(((date - yearStart) / 86400000 + 1) / 7);
         return weekNumber;
       }
       
       function calculateWeekAndYearForm1() {
         const currentDate = new Date();
         const weekNumber = getWeekNumber(currentDate);
         const year = currentDate.getFullYear();
         
         // Set the calculated values in the hidden input fields
         document.getElementById("week_number_Form1").value = weekNumber;
         document.getElementById("year_form1").value = year;
       }

  </script>
</html>